# =============================================================================
# Infrastructure Topology: r8g.2xlarge.15.10.8disk.raid10
# =============================================================================
# This file documents the full infrastructure topology for this hardware context.
# Used for documentation and potentially for automated provisioning.
# =============================================================================

name: r8g.2xlarge.15.10.8disk.raid10
description: "PostgreSQL on r8g.2xlarge (memory optimized) with 8-disk RAID10, PgCat proxy"

# -----------------------------------------------------------------------------
# Components
# -----------------------------------------------------------------------------
components:
  db:
    enabled: true
    count: 1
    instance_type: r8g.2xlarge
    specs:
      vcpu: 8
      ram_gb: 64
      network_gbps: 15
      ebs_gbps: 10
    storage:
      data:
        disk_count: 8
        disk_size_gb: 50
        raid_level: 10
        usable_gb: 200
      wal:
        disk_count: 8
        disk_size_gb: 30
        raid_level: 10
        usable_gb: 120
    config: config.env

  proxy:
    enabled: true
    count: 1
    instance_type: c8g.2xlarge
    software: pgcat
    version: "1.3.0"
    config: proxy/pgcat.toml

  replica:
    enabled: false
    count: 0

  olap:
    enabled: false
    type: null  # risingwave, clickhouse, etc.

# -----------------------------------------------------------------------------
# Benchmark Results (to be filled after benchmarking)
# -----------------------------------------------------------------------------
benchmark:
  workload: pgbench_tpcb
  scale: 1374
  clients: 100
  results:
    tps_avg: null  # TBD
    tps_peak: null
    tps_min: null
    latency_avg_ms: null

# -----------------------------------------------------------------------------
# Cost Estimate (us-west-2, monthly)
# -----------------------------------------------------------------------------
cost:
  db_ondemand: 387.79  # r8g.2xlarge
  db_spot: 116.34
  ebs_data: 25.60
  ebs_wal: 15.36
  proxy_ondemand: 208.08
  proxy_spot: 62.64
  total_ondemand: 636.83
  total_spot: 219.94
