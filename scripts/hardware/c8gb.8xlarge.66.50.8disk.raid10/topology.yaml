# =============================================================================
# Infrastructure Topology: c8gb.8xlarge.66.50.8disk.raid10
# =============================================================================
# This file documents the full infrastructure topology for this hardware context.
# Used for documentation and potentially for automated provisioning.
# =============================================================================

name: c8gb.8xlarge.66.50.8disk.raid10
description: "PostgreSQL on c8gb.8xlarge (compute + block optimized) with 8-disk RAID10, PgCat proxy"

# -----------------------------------------------------------------------------
# Components
# -----------------------------------------------------------------------------
components:
  db:
    enabled: true
    count: 1
    instance_type: c8gb.8xlarge
    specs:
      vcpu: 32
      ram_gb: 64
      network_gbps: 66
      ebs_gbps: 50
    storage:
      data:
        disk_count: 8
        disk_size_gb: 50
        raid_level: 10
        usable_gb: 200
      wal:
        disk_count: 8
        disk_size_gb: 30
        raid_level: 10
        usable_gb: 120
    config: config.env

  proxy:
    enabled: true
    count: 1
    instance_type: c8g.2xlarge
    software: pgcat
    version: "1.3.0"
    config: proxy/pgcat.toml

  replica:
    enabled: false
    count: 0

  olap:
    enabled: false
    type: null  # risingwave, clickhouse, etc.

# -----------------------------------------------------------------------------
# Benchmark Results
# -----------------------------------------------------------------------------
benchmark:
  workload: pgbench_tpcb
  scale: 1374
  clients: 100
  results:
    # Scenario B: shared_buffers=20GB, parallel workers optimized for 32 vCPU
    tps_avg: 31532
    tps_peak: 33565
    tps_min: 28743
    latency_avg_ms: 3.0
    io_cliff: false  # Eliminated by matching shared_buffers to dataset size

# -----------------------------------------------------------------------------
# Cost Estimate (us-west-2, monthly)
# -----------------------------------------------------------------------------
cost:
  db_ondemand: 832.32   # c8gb.8xlarge
  db_spot: 249.70
  ebs_data: 25.60
  ebs_wal: 15.36
  proxy_ondemand: 208.08
  proxy_spot: 62.64
  total_ondemand: 1081.36
  total_spot: 353.30
