# =============================================================================
# OS CONFIG: Kernel/Memory/TCP Tuning (Golden Fact - 11,300 TPS ceiling)
# =============================================================================
# These settings are proven optimal for PostgreSQL workloads.
# Apply to ALL database instances: primary, replica.
# =============================================================================

# =============================================================================
# MEMORY - VM Settings
# =============================================================================
VM_SWAPPINESS=1
VM_DIRTY_BACKGROUND_RATIO=1
VM_DIRTY_RATIO=4
VM_DIRTY_EXPIRE_CENTISECS=200
VM_DIRTY_WRITEBACK_CENTISECS=100
VM_OVERCOMMIT_MEMORY=2
VM_OVERCOMMIT_RATIO=80
VM_MIN_FREE_KBYTES=335544
VM_ZONE_RECLAIM_MODE=0
VM_NR_HUGEPAGES=4382

# =============================================================================
# FILE DESCRIPTORS
# =============================================================================
FS_FILE_MAX=2097152
FS_AIO_MAX_NR=1048576
ULIMIT_NOFILE=65535
ULIMIT_NPROC=65535

# =============================================================================
# NETWORK / TCP
# =============================================================================
NET_CORE_SOMAXCONN=4096
NET_CORE_NETDEV_MAX_BACKLOG=2048
NET_CORE_RMEM_DEFAULT=262144
NET_CORE_RMEM_MAX=16777216
NET_CORE_WMEM_DEFAULT=262144
NET_CORE_WMEM_MAX=16777216
NET_IPV4_TCP_RMEM="4096 87380 16777216"
NET_IPV4_TCP_WMEM="4096 65536 16777216"
NET_IPV4_TCP_MAX_SYN_BACKLOG=4096
NET_IPV4_TCP_TW_REUSE=1
NET_IPV4_TCP_FIN_TIMEOUT=15

# =============================================================================
# KERNEL / SCHEDULER
# =============================================================================
KERNEL_SCHED_AUTOGROUP_ENABLED=0
KERNEL_NUMA_BALANCING=0
KERNEL_SEM="250 32000 100 128"
THP_ENABLED=never
