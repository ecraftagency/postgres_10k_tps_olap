# =============================================================================
# PgCat Configuration - OLAP 10K TPS Optimized with Replicas
# =============================================================================
# PostgreSQL connection pooler - https://github.com/postgresml/pgcat
# Target: 10,000 TPS OLAP workload
# Hardware: c8g.xlarge proxy (4 vCPU, 8GB RAM)
# Topology: 1 primary + 1 sync replica + 1 async replica
# =============================================================================

[general]
host = "0.0.0.0"
port = 6432
worker_threads = 8
admin_username = "admin"
admin_password = "admin"
connect_timeout = 10000
idle_timeout = 600000
server_lifetime = 1800000
tcp_keepalives_idle = 30
tcp_keepalives_count = 3
tcp_keepalives_interval = 10
shutdown_timeout = 60000
healthcheck_delay = 5000
healthcheck_timeout = 1000
ban_time = 30
log_level = "info"

# =============================================================================
# Connection Pool - OLAP Optimized with Read/Write Split
# =============================================================================

[pools.bench]
pool_mode = "transaction"
load_balancing_mode = "random"
default_role = "primary"
query_parser_enabled = true
query_parser_read_write_splitting = true
pool_size = 300
min_pool_size = 50
prepared_statements_cache_size = 500

[pools.bench.users.0]
username = "postgres"
password = "postgres"
pool_size = 300
min_pool_size = 50

[pools.bench.shards.0]
database = "bench"
servers = [
    ["10.0.1.10", 5432, "primary"],
    ["10.0.1.11", 5432, "replica"],
    ["10.0.1.12", 5432, "replica"]
]

# =============================================================================
# Sysbench Pool - TPC-C with Read/Write Split
# =============================================================================

[pools.sysbench]
pool_mode = "transaction"
load_balancing_mode = "random"
default_role = "primary"
query_parser_enabled = true
query_parser_read_write_splitting = true
pool_size = 300
min_pool_size = 50
prepared_statements_cache_size = 500

[pools.sysbench.users.0]
username = "postgres"
password = "postgres"
pool_size = 300
min_pool_size = 50

[pools.sysbench.shards.0]
database = "sysbench"
servers = [
    ["10.0.1.10", 5432, "primary"],
    ["10.0.1.11", 5432, "replica"],
    ["10.0.1.12", 5432, "replica"]
]

# =============================================================================
# Postgres Pool - For monitoring/diagnostics (primary only)
# =============================================================================

[pools.postgres]
pool_mode = "transaction"
load_balancing_mode = "random"
default_role = "primary"
query_parser_enabled = false
query_parser_read_write_splitting = false
pool_size = 20
min_pool_size = 5

[pools.postgres.users.0]
username = "postgres"
password = "postgres"
pool_size = 20
min_pool_size = 5

[pools.postgres.shards.0]
database = "postgres"
servers = [
    ["10.0.1.10", 5432, "primary"]
]
