# =============================================================================
# PRIMARY CONFIG: r8g.xlarge (Golden Fact - 11,300 TPS ceiling)
# =============================================================================
# Instance: r8g.xlarge (Memory Optimized, Graviton4)
# vCPU: 4 | RAM: 32 GB
# Role: Primary Database Node
# =============================================================================

# === INSTANCE SPECS ===
INSTANCE_TYPE=r8g.xlarge
VCPU=4
RAM_GB=32

# === STORAGE CONFIG ===
DATA_DISK_COUNT=4
DATA_DISK_SIZE_GB=50
WAL_DISK_COUNT=4
WAL_DISK_SIZE_GB=30

# === POSTGRESQL - PATHS ===
PG_VERSION=16
PG_DATA_DIR=/data/postgresql
PG_WAL_DIR=/wal/pg_wal
PG_LISTEN_ADDRESSES=*
PG_PORT=5432

# === POSTGRESQL - CONNECTIONS ===
PG_MAX_CONNECTIONS=300

# === POSTGRESQL - MEMORY (fixed values for 32GB RAM) ===
PG_SHARED_BUFFERS=8GB
PG_EFFECTIVE_CACHE_SIZE=22GB
PG_WORK_MEM=5MB
PG_MAINTENANCE_WORK_MEM=1638MB
PG_HUGE_PAGES=try

# === POSTGRESQL - WAL ===
PG_WAL_LEVEL=replica
PG_WAL_COMPRESSION=lz4
PG_WAL_SYNC_METHOD=fdatasync
PG_WAL_BUFFERS=64MB
PG_WAL_WRITER_DELAY=10ms
PG_SYNCHRONOUS_COMMIT=on
PG_MAX_WAL_SIZE=32GB
PG_MIN_WAL_SIZE=2GB

# === POSTGRESQL - CHECKPOINT ===
PG_CHECKPOINT_TIMEOUT=15min
PG_CHECKPOINT_COMPLETION_TARGET=0.9

# === POSTGRESQL - BACKGROUND WRITER ===
PG_BGWRITER_DELAY=10ms
PG_BGWRITER_LRU_MAXPAGES=400
PG_BGWRITER_LRU_MULTIPLIER=4

# === POSTGRESQL - PARALLEL ===
PG_MAX_WORKER_PROCESSES=4
PG_MAX_PARALLEL_WORKERS=4
PG_MAX_PARALLEL_WORKERS_PER_GATHER=2
PG_MAX_PARALLEL_MAINTENANCE_WORKERS=2

# === POSTGRESQL - I/O ===
PG_EFFECTIVE_IO_CONCURRENCY=200
PG_MAINTENANCE_IO_CONCURRENCY=10
PG_RANDOM_PAGE_COST=1.1
PG_SEQ_PAGE_COST=1.0

# === POSTGRESQL - STATS ===
PG_TRACK_IO_TIMING=on
PG_TRACK_WAL_IO_TIMING=on
PG_LOG_CHECKPOINTS=on
