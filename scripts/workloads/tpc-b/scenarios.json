{
  "disks": {
    "data": {
      "name": "DATA",
      "mount_point": "/data",
      "device": "/dev/md0",
      "volumes": [
        "nvme2n1",
        "nvme3n1",
        "nvme5n1",
        "nvme8n1",
        "nvme9n1",
        "nvme11n1",
        "nvme12n1",
        "nvme15n1"
      ]
    },
    "wal": {
      "name": "WAL",
      "mount_point": "/wal",
      "device": "/dev/md1",
      "volumes": [
        "nvme1n1",
        "nvme4n1",
        "nvme6n1",
        "nvme7n1",
        "nvme10n1",
        "nvme13n1",
        "nvme14n1",
        "nvme16n1"
      ]
    },
    "postgres": {
      "name": "POSTGRES",
      "mount_point": "/data,/wal",
      "device": "/dev/md0,/dev/md1",
      "volumes": [
        "nvme1n1",
        "nvme2n1",
        "nvme3n1",
        "nvme4n1",
        "nvme5n1",
        "nvme6n1",
        "nvme7n1",
        "nvme8n1",
        "nvme9n1",
        "nvme10n1",
        "nvme11n1",
        "nvme12n1",
        "nvme13n1",
        "nvme14n1",
        "nvme15n1",
        "nvme16n1",
        "md0",
        "md1"
      ]
    }
  },
  "scenarios": {
    "1": {
      "id": "wal_heartbeat",
      "name": "The Heartbeat",
      "desc": "Commit Latency - Single backend sync write (QD1+fdatasync)",
      "target_disk": "wal",
      "duration": 60,
      "begin": [],
      "parallel": [
        {
          "name": "fio",
          "cmd": [
            "fio",
            "--name=wal_commit_latency",
            "--filename=/wal/bench_wal_lat",
            "--size=2G",
            "--time_based",
            "--runtime={duration}s",
            "--ioengine=libaio",
            "--direct=1",
            "--bs=8k",
            "--rw=write",
            "--fdatasync=1",
            "--iodepth=1",
            "--numjobs=1",
            "--group_reporting"
          ],
          "primary": true,
          "cleanup": "/wal/bench_wal_lat"
        },
        {
          "name": "iostat",
          "cmd": [
            "iostat",
            "-xz",
            "1",
            "{duration}"
          ],
          "filter_volumes": true
        },
        {
          "name": "mpstat",
          "cmd": [
            "mpstat",
            "-P",
            "ALL",
            "1",
            "{duration}"
          ]
        }
      ],
      "end": []
    },
    "2": {
      "id": "data_stress",
      "name": "Stress Test",
      "desc": "Mixed IOPS - Random R/W 70:30 at saturation (QD64x4)",
      "target_disk": "data",
      "duration": 60,
      "begin": [],
      "parallel": [
        {
          "name": "fio",
          "cmd": [
            "fio",
            "--name=data_stress_test",
            "--filename=/data/bench_data_stress",
            "--size=5G",
            "--time_based",
            "--runtime={duration}s",
            "--ioengine=libaio",
            "--direct=1",
            "--bs=8k",
            "--rw=randrw",
            "--rwmixread=70",
            "--iodepth=64",
            "--numjobs=4",
            "--group_reporting"
          ],
          "primary": true,
          "cleanup": "/data/bench_data_stress"
        },
        {
          "name": "iostat",
          "cmd": [
            "iostat",
            "-xz",
            "1",
            "{duration}"
          ],
          "filter_volumes": true
        },
        {
          "name": "mpstat",
          "cmd": [
            "mpstat",
            "-P",
            "ALL",
            "1",
            "{duration}"
          ]
        }
      ],
      "end": []
    },
    "3": {
      "id": "data_latency",
      "name": "Latency",
      "desc": "Single Thread Random Read - True EBS latency (QD1)",
      "target_disk": "data",
      "duration": 60,
      "begin": [],
      "parallel": [
        {
          "name": "fio",
          "cmd": [
            "fio",
            "--name=data_latency_test",
            "--filename=/data/bench_data_lat",
            "--size=5G",
            "--time_based",
            "--runtime={duration}s",
            "--ioengine=libaio",
            "--direct=1",
            "--bs=8k",
            "--rw=randread",
            "--iodepth=1",
            "--numjobs=1",
            "--group_reporting"
          ],
          "primary": true,
          "cleanup": "/data/bench_data_lat"
        },
        {
          "name": "iostat",
          "cmd": [
            "iostat",
            "-xz",
            "1",
            "{duration}"
          ],
          "filter_volumes": true
        },
        {
          "name": "mpstat",
          "cmd": [
            "mpstat",
            "-P",
            "ALL",
            "1",
            "{duration}"
          ]
        }
      ],
      "end": []
    },
    "4": {
      "id": "data_throughput",
      "name": "Throughput",
      "desc": "Sequential Read - Max bandwidth (1MB blocks, QD16)",
      "target_disk": "data",
      "duration": 60,
      "begin": [],
      "parallel": [
        {
          "name": "fio",
          "cmd": [
            "fio",
            "--name=data_throughput_test",
            "--filename=/data/bench_data_bw",
            "--size=5G",
            "--time_based",
            "--runtime={duration}s",
            "--ioengine=libaio",
            "--direct=1",
            "--bs=1M",
            "--rw=read",
            "--iodepth=16",
            "--numjobs=1",
            "--group_reporting"
          ],
          "primary": true,
          "cleanup": "/data/bench_data_bw"
        },
        {
          "name": "iostat",
          "cmd": [
            "iostat",
            "-xz",
            "1",
            "{duration}"
          ],
          "filter_volumes": true
        },
        {
          "name": "mpstat",
          "cmd": [
            "mpstat",
            "-P",
            "ALL",
            "1",
            "{duration}"
          ]
        }
      ],
      "end": []
    },
    "5": {
      "id": "wal_firehose",
      "name": "The Firehose",
      "desc": "Sequential Throughput - Max write bandwidth (1MB blocks, no fsync)",
      "target_disk": "wal",
      "duration": 60,
      "begin": [],
      "parallel": [
        {
          "name": "fio",
          "cmd": [
            "fio",
            "--name=wal_throughput",
            "--filename=/wal/bench_wal_bw",
            "--size=5G",
            "--time_based",
            "--runtime={duration}s",
            "--ioengine=libaio",
            "--direct=1",
            "--bs=1M",
            "--rw=write",
            "--iodepth=16",
            "--numjobs=1",
            "--group_reporting"
          ],
          "primary": true,
          "cleanup": "/wal/bench_wal_bw"
        },
        {
          "name": "iostat",
          "cmd": [
            "iostat",
            "-xz",
            "1",
            "{duration}"
          ],
          "filter_volumes": true
        },
        {
          "name": "mpstat",
          "cmd": [
            "mpstat",
            "-P",
            "ALL",
            "1",
            "{duration}"
          ]
        }
      ],
      "end": []
    },
    "6": {
      "id": "wal_trafficjam",
      "name": "The Traffic Jam",
      "desc": "Group Commit Stress - Multi-thread sync write (QD32x4+fdatasync)",
      "target_disk": "wal",
      "duration": 60,
      "begin": [],
      "parallel": [
        {
          "name": "fio",
          "cmd": [
            "fio",
            "--name=wal_group_commit",
            "--filename=/wal/bench_wal_stress",
            "--size=5G",
            "--time_based",
            "--runtime={duration}s",
            "--ioengine=libaio",
            "--direct=1",
            "--bs=32k",
            "--rw=write",
            "--fdatasync=1",
            "--iodepth=32",
            "--numjobs=4",
            "--group_reporting"
          ],
          "primary": true,
          "cleanup": "/wal/bench_wal_stress"
        },
        {
          "name": "iostat",
          "cmd": [
            "iostat",
            "-xz",
            "1",
            "{duration}"
          ],
          "filter_volumes": true
        },
        {
          "name": "mpstat",
          "cmd": [
            "mpstat",
            "-P",
            "ALL",
            "1",
            "{duration}"
          ]
        }
      ],
      "end": []
    },
    "7": {
      "id": "data_seq_write",
      "name": "Sequential Write",
      "desc": "Checkpoint-style - Large sequential writes (1MB blocks, QD16)",
      "target_disk": "data",
      "duration": 60,
      "begin": [],
      "parallel": [
        {
          "name": "fio",
          "cmd": [
            "fio",
            "--name=data_seq_write_test",
            "--filename=/data/bench_data_seqw",
            "--size=5G",
            "--time_based",
            "--runtime={duration}s",
            "--ioengine=libaio",
            "--direct=1",
            "--bs=1M",
            "--rw=write",
            "--iodepth=16",
            "--numjobs=1",
            "--group_reporting"
          ],
          "primary": true,
          "cleanup": "/data/bench_data_seqw"
        },
        {
          "name": "iostat",
          "cmd": [
            "iostat",
            "-xz",
            "1",
            "{duration}"
          ],
          "filter_volumes": true
        },
        {
          "name": "mpstat",
          "cmd": [
            "mpstat",
            "-P",
            "ALL",
            "1",
            "{duration}"
          ]
        }
      ],
      "end": []
    },
    "8": {
      "id": "data_rand_write",
      "name": "Random Write",
      "desc": "Pure Write IOPS - Random writes only (8K blocks, QD64x4)",
      "target_disk": "data",
      "duration": 60,
      "begin": [],
      "parallel": [
        {
          "name": "fio",
          "cmd": [
            "fio",
            "--name=data_rand_write_test",
            "--filename=/data/bench_data_randw",
            "--size=5G",
            "--time_based",
            "--runtime={duration}s",
            "--ioengine=libaio",
            "--direct=1",
            "--bs=8k",
            "--rw=randwrite",
            "--iodepth=64",
            "--numjobs=4",
            "--group_reporting"
          ],
          "primary": true,
          "cleanup": "/data/bench_data_randw"
        },
        {
          "name": "iostat",
          "cmd": [
            "iostat",
            "-xz",
            "1",
            "{duration}"
          ],
          "filter_volumes": true
        },
        {
          "name": "mpstat",
          "cmd": [
            "mpstat",
            "-P",
            "ALL",
            "1",
            "{duration}"
          ]
        }
      ],
      "end": []
    },
    "9": {
      "id": "data_mixed_sync",
      "name": "Mixed Sync",
      "desc": "DB-Realistic - Random R/W 70:30 with fdatasync (QD32x4)",
      "target_disk": "data",
      "duration": 60,
      "begin": [],
      "parallel": [
        {
          "name": "fio",
          "cmd": [
            "fio",
            "--name=data_mixed_sync_test",
            "--filename=/data/bench_data_sync",
            "--size=5G",
            "--time_based",
            "--runtime={duration}s",
            "--ioengine=libaio",
            "--direct=1",
            "--bs=8k",
            "--rw=randrw",
            "--rwmixread=70",
            "--fdatasync=1",
            "--iodepth=32",
            "--numjobs=4",
            "--group_reporting"
          ],
          "primary": true,
          "cleanup": "/data/bench_data_sync"
        },
        {
          "name": "iostat",
          "cmd": [
            "iostat",
            "-xz",
            "1",
            "{duration}"
          ],
          "filter_volumes": true
        },
        {
          "name": "mpstat",
          "cmd": [
            "mpstat",
            "-P",
            "ALL",
            "1",
            "{duration}"
          ]
        }
      ],
      "end": []
    },
    "10": {
      "id": "wal_replay",
      "name": "Recovery Replay",
      "desc": "Sequential Read - Simulates Replica Catch-up or Crash Recovery",
      "target_disk": "wal",
      "duration": 60,
      "begin": [],
      "parallel": [
        {
          "name": "fio",
          "cmd": [
            "fio",
            "--name=wal_read_replay",
            "--filename=/wal/bench_wal_replay",
            "--size=5G",
            "--time_based",
            "--runtime={duration}s",
            "--ioengine=libaio",
            "--direct=1",
            "--bs=1M",
            "--rw=read",
            "--iodepth=8",
            "--numjobs=1",
            "--group_reporting"
          ],
          "primary": true,
          "cleanup": "/wal/bench_wal_replay"
        },
        {
          "name": "iostat",
          "cmd": [
            "iostat",
            "-xz",
            "1",
            "{duration}"
          ],
          "filter_volumes": true
        },
        {
          "name": "mpstat",
          "cmd": [
            "mpstat",
            "-P",
            "ALL",
            "1",
            "{duration}"
          ]
        }
      ],
      "end": []
    },
    "11": {
      "id": "postgres_tpcb",
      "name": "TPC-B Write Intensive",
      "desc": "Standard OLTP Benchmark (Read/Write/Update)",
      "target_disk": "postgres",
      "duration": 60,
      "begin": [
        {
          "name": "checkpoint",
          "cmd": [
            "sudo",
            "-u",
            "postgres",
            "psql",
            "-c",
            "CHECKPOINT;"
          ]
        },
        {
          "name": "pg_stat_reset",
          "cmd": [
            "sudo",
            "-u",
            "postgres",
            "psql",
            "-c",
            "SELECT pg_stat_reset(); SELECT pg_stat_reset_shared('bgwriter');"
          ]
        }
      ],
      "parallel": [
        {
          "name": "mpstat",
          "cmd": [
            "mpstat",
            "1",
            "{duration}"
          ]
        },
        {
          "name": "iostat",
          "cmd": [
            "iostat",
            "-xk",
            "1",
            "{duration}"
          ]
        },
        {
          "name": "pg_wait_events",
          "cmd": [
            "bash",
            "-c",
            "for i in $(seq 1 {duration}); do echo \"=== $(date '+%H:%M:%S') ===\"; sudo -u postgres psql -t -c \"SELECT coalesce(wait_event_type,'CPU') as type, coalesce(wait_event,'Running') as event, count(*) as cnt FROM pg_stat_activity WHERE state='active' AND pid<>pg_backend_pid() GROUP BY 1,2 ORDER BY 3 DESC LIMIT 5\"; sleep 1; done"
          ]
        },
        {
          "name": "pg_deep_stats",
          "cmd": [
            "bash",
            "-c",
            "echo 'Time,HitRatio,TPS,Active,WaitLock,Deadlock,WalBytes,DirtyBuf'; for i in $(seq 1 12); do sudo -u postgres psql -t -A -F',' -c \"SELECT to_char(now(), 'HH24:MI:SS'), round(d.blks_hit::numeric / (d.blks_hit + d.blks_read + 1) * 100, 2), (d.xact_commit + d.xact_rollback), (SELECT count(*) FROM pg_stat_activity WHERE state='active'), (SELECT count(*) FROM pg_stat_activity WHERE wait_event_type='Lock'), d.deadlocks, w.wal_bytes, b.buffers_checkpoint + b.buffers_clean + b.buffers_backend FROM pg_stat_database d, pg_stat_bgwriter b, pg_stat_wal w WHERE d.datname = current_database()\"; sleep 5; done"
          ]
        },
        {
          "name": "pgbench",
          "cmd": [
            "sudo",
            "-u",
            "postgres",
            "pgbench",
            "-c",
            "100",
            "-j",
            "16",
            "-T",
            "{duration}",
            "-P",
            "5",
            "pgbench"
          ],
          "primary": true
        }
      ],
      "end": []
    },
    "12": {
      "id": "postgres_pure_read",
      "name": "Pure Read (Select Only)",
      "desc": "Tests RAM throughput, CPU context switching and Network PPS",
      "target_disk": "postgres",
      "duration": 60,
      "begin": [
        {
          "name": "pg_stat_reset",
          "cmd": [
            "sudo",
            "-u",
            "postgres",
            "psql",
            "-c",
            "SELECT pg_stat_reset();"
          ]
        }
      ],
      "parallel": [
        {
          "name": "vmstat",
          "cmd": [
            "vmstat",
            "1",
            "{duration}"
          ]
        },
        {
          "name": "mpstat_per_core",
          "cmd": [
            "mpstat",
            "-P",
            "ALL",
            "1",
            "{duration}"
          ]
        },
        {
          "name": "pg_deep_stats",
          "cmd": [
            "bash",
            "-c",
            "echo 'Time,HitRatio,TPS'; for i in $(seq 1 12); do sudo -u postgres psql -t -A -F',' -c \"SELECT to_char(now(), 'HH24:MI:SS'), round(d.blks_hit::numeric / (d.blks_hit + d.blks_read + 1) * 100, 2), (d.xact_commit + d.xact_rollback) FROM pg_stat_database d WHERE d.datname = current_database()\"; sleep 5; done"
          ]
        },
        {
          "name": "pgbench",
          "cmd": [
            "sudo",
            "-u",
            "postgres",
            "pgbench",
            "-S",
            "-c",
            "100",
            "-j",
            "16",
            "-T",
            "{duration}",
            "-P",
            "5",
            "pgbench"
          ],
          "primary": true
        }
      ],
      "end": []
    },
    "13": {
      "id": "postgres_connection_storm",
      "name": "Connection Storm",
      "desc": "Tests authentication overhead (connect per transaction)",
      "target_disk": "postgres",
      "duration": 60,
      "begin": [],
      "parallel": [
        {
          "name": "dstat_tcp",
          "cmd": [
            "dstat",
            "-tn",
            "1",
            "{duration}"
          ]
        },
        {
          "name": "pg_conn_stats",
          "cmd": [
            "bash",
            "-c",
            "for i in $(seq 1 12); do echo \"=== $(date '+%H:%M:%S') ===\"; sudo -u postgres psql -t -c \"SELECT state, count(*) FROM pg_stat_activity GROUP BY 1 ORDER BY 2 DESC\"; sleep 5; done"
          ]
        },
        {
          "name": "pgbench",
          "cmd": [
            "sudo",
            "-u",
            "postgres",
            "pgbench",
            "-S",
            "-C",
            "-c",
            "50",
            "-j",
            "8",
            "-T",
            "{duration}",
            "-P",
            "5",
            "pgbench"
          ],
          "primary": true
        }
      ],
      "end": []
    },
    "14": {
      "id": "postgres_high_concurrency",
      "name": "High Concurrency Locking",
      "desc": "1000 Clients fighting for resources",
      "target_disk": "postgres",
      "duration": 60,
      "begin": [
        {
          "name": "pg_stat_reset",
          "cmd": [
            "sudo",
            "-u",
            "postgres",
            "psql",
            "-c",
            "SELECT pg_stat_reset();"
          ]
        }
      ],
      "parallel": [
        {
          "name": "vmstat",
          "cmd": [
            "vmstat",
            "1",
            "{duration}"
          ]
        },
        {
          "name": "pg_wait_events",
          "cmd": [
            "bash",
            "-c",
            "for i in $(seq 1 {duration}); do echo \"=== $(date '+%H:%M:%S') ===\"; sudo -u postgres psql -t -c \"SELECT coalesce(wait_event_type,'CPU') as type, coalesce(wait_event,'Running') as event, count(*) as cnt FROM pg_stat_activity WHERE state='active' AND pid<>pg_backend_pid() GROUP BY 1,2 ORDER BY 3 DESC LIMIT 5\"; sleep 1; done"
          ]
        },
        {
          "name": "pg_deep_stats",
          "cmd": [
            "bash",
            "-c",
            "echo 'Time,Active,WaitLock,Deadlock'; for i in $(seq 1 12); do sudo -u postgres psql -t -A -F',' -c \"SELECT to_char(now(), 'HH24:MI:SS'), (SELECT count(*) FROM pg_stat_activity WHERE state='active'), (SELECT count(*) FROM pg_stat_activity WHERE wait_event_type='Lock'), d.deadlocks FROM pg_stat_database d WHERE d.datname = current_database()\"; sleep 5; done"
          ]
        },
        {
          "name": "pgbench",
          "cmd": [
            "sudo",
            "-u",
            "postgres",
            "pgbench",
            "-c",
            "1000",
            "-j",
            "32",
            "-T",
            "{duration}",
            "-P",
            "5",
            "pgbench"
          ],
          "primary": true
        }
      ],
      "end": []
    }
  }
}