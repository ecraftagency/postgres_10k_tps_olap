# =============================================================================
# INFRASTRUCTURE SPECIFICATION
# -----------------------------------------------------------------------------
# Dynamic hardware specs for elastic scaling environments.
# All KPI ceilings and thresholds are calculated from these values.
# =============================================================================

[instance]
# EC2 Instance Specification
# Source: https://instances.vantage.sh/aws/ec2/c8gb.2xlarge
type = "c8gb.2xlarge"
family = "c8gb"             # Compute optimized, Graviton4, block storage optimized
architecture = "arm64"
vcpu = 8
memory_gb = 16

# Network Performance
# c8gb.2xlarge: Up to 33.33 Gbps (enhanced networking)
network_bandwidth_gbps = 33.33

# EBS Performance (instance-level limits)
# c8gb.2xlarge: Up to 25 Gbps = 3125 MB/s
# "b" suffix = block storage optimized with higher EBS throughput
ebs_bandwidth_gbps = 25
ebs_bandwidth_mbps = 3125        # 25 Gbps = 3125 MB/s
ebs_baseline_iops = 40000        # Instance IOPS limit

# =============================================================================
# EBS VOLUME SPECIFICATION
# =============================================================================

[ebs.gp3]
# gp3 Volume Type Specification
# Default: 3000 IOPS, 125 MB/s throughput
# Max: 16000 IOPS, 1000 MB/s throughput
volume_type = "gp3"
baseline_iops = 3000
max_iops = 16000
baseline_throughput_mbps = 125
max_throughput_mbps = 1000

# Price per provisioned IOPS above baseline ($/IOPS/month)
# This helps calculate cost-optimal configurations
price_per_iops = 0.005
price_per_mbps = 0.04

[ebs.io2]
# io2 Volume Type Specification (for reference)
volume_type = "io2"
max_iops = 64000
max_iops_per_gb = 500
max_throughput_mbps = 1000

# =============================================================================
# PROVISIONED CONFIGURATION
# -----------------------------------------------------------------------------
# Actual values for THIS deployment. Change these when scaling.
# =============================================================================

[provisioned.data]
# DATA Volume Provisioning
disk_count = 8
disk_size_gb = 50
volume_type = "gp3"
provisioned_iops = 3000      # Per disk
provisioned_throughput_mbps = 125  # Per disk

# Calculated ceilings (RAID10):
# - Read IOPS: disk_count * provisioned_iops = 8 * 3000 = 24000
# - Write IOPS: (disk_count / 2) * provisioned_iops = 4 * 3000 = 12000
# - Throughput: (disk_count / 2) * provisioned_throughput = 4 * 125 = 500 MB/s

[provisioned.wal]
# WAL Volume Provisioning
disk_count = 8
disk_size_gb = 30
volume_type = "gp3"
provisioned_iops = 3000
provisioned_throughput_mbps = 125

# Note: WAL at QD1 is EBS network latency-bound (~0.5-1ms per op)
# Max QD1 IOPS = 1000 / latency_ms â‰ˆ 1000-2000 IOPS
# This is NOT limited by volume IOPS but by network RTT

# =============================================================================
# NETWORK LATENCY (EBS)
# -----------------------------------------------------------------------------
# EBS volumes communicate over network, adding latency
# =============================================================================

[network.ebs]
# EBS network round-trip time
# This limits QD1 (queue depth 1) performance
min_latency_ms = 0.3        # Best case (same AZ, light load)
typical_latency_ms = 0.5    # Normal operation
max_latency_ms = 1.0        # Worst case (cross-AZ, congestion)

# Calculated QD1 ceiling:
# QD1 IOPS = 1000 / latency_ms
# At 0.5ms: 2000 IOPS
# At 1.0ms: 1000 IOPS

# =============================================================================
# CALCULATED CEILINGS (Auto-computed by benchmark)
# -----------------------------------------------------------------------------
# These are calculated from provisioned values, shown here for reference
# =============================================================================

[ceilings.data]
# Calculated from provisioned.data
# read_iops = disk_count * provisioned_iops
# write_iops = (disk_count / 2) * provisioned_iops (RAID10 mirror)
# throughput_mbps = (disk_count / 2) * provisioned_throughput_mbps
read_iops = 24000
write_iops = 12000
throughput_mbps = 500

[ceilings.wal]
# Sequential throughput ceiling
read_iops = 24000
write_iops = 12000
throughput_mbps = 500

# QD1 ceiling (latency-bound)
qd1_iops_min = 1000     # At 1ms latency
qd1_iops_typical = 2000  # At 0.5ms latency

# =============================================================================
# THRESHOLD CONFIGURATION
# -----------------------------------------------------------------------------
# KPI thresholds as percentage of ceiling
# =============================================================================

[thresholds.percent]
# Target performance as % of hardware ceiling
target_iops_percent = 70        # Aim for 70% of ceiling
warning_iops_percent = 80       # Warn if > 80% sustained
critical_iops_percent = 95      # Critical if > 95%

target_throughput_percent = 80
warning_throughput_percent = 90
critical_throughput_percent = 95

# WAL QD1 is special - we expect near 100% of latency-bound ceiling
wal_qd1_target_percent = 60     # 60% of theoretical QD1 max
