# =============================================================================
# WORKLOAD CONTEXT: TPC-C (HammerDB OLTP)
# =============================================================================
# Optimized for: Heavy OLTP with complex transactions
# Benchmark tool: HammerDB
# Dataset: ~40GB (400 warehouses)
# Target: 350,000+ NOPM
# =============================================================================

# =============================================================================
# HUGEPAGES (calculated from shared_buffers)
# =============================================================================
VM_NR_HUGEPAGES=11000

# =============================================================================
# POSTGRESQL - PATHS
# =============================================================================
PG_VERSION=16
PG_DATA_DIR="/data/postgresql"
PG_WAL_DIR="/wal/pg_wal"
PG_LISTEN_ADDRESSES="*"
PG_PORT=5432

# =============================================================================
# POSTGRESQL - CONNECTIONS & MEMORY
# -----------------------------------------------------------------------------
# Similar to TPC-B but higher connections for warehouse concurrency
# =============================================================================
PG_MAX_CONNECTIONS=500
PG_SHARED_BUFFERS="20GB"
PG_HUGE_PAGES="on"
PG_WORK_MEM="32MB"
PG_MAINTENANCE_WORK_MEM="1GB"
PG_EFFECTIVE_CACHE_SIZE="44GB"

# =============================================================================
# POSTGRESQL - DISK I/O
# =============================================================================
PG_RANDOM_PAGE_COST="1.1"
PG_SEQ_PAGE_COST="1.0"
PG_EFFECTIVE_IO_CONCURRENCY=200

# =============================================================================
# POSTGRESQL - WAL
# =============================================================================
PG_WAL_COMPRESSION="lz4"
PG_WAL_BUFFERS="256MB"
PG_WAL_WRITER_DELAY="10ms"
PG_WAL_WRITER_FLUSH_AFTER="1MB"

# =============================================================================
# POSTGRESQL - CHECKPOINT
# =============================================================================
PG_MAX_WAL_SIZE="100GB"
PG_MIN_WAL_SIZE="4GB"
PG_CHECKPOINT_TIMEOUT="1h"
PG_CHECKPOINT_COMPLETION_TARGET="0.9"

# =============================================================================
# POSTGRESQL - SYNC & GROUP COMMIT
# =============================================================================
PG_SYNCHRONOUS_COMMIT="on"
PG_COMMIT_DELAY=0
PG_COMMIT_SIBLINGS=5

# =============================================================================
# POSTGRESQL - BACKGROUND WRITER
# =============================================================================
PG_BGWRITER_DELAY="10ms"
PG_BGWRITER_LRU_MAXPAGES=1000
PG_BGWRITER_LRU_MULTIPLIER="4.0"

# =============================================================================
# POSTGRESQL - AUTOVACUUM
# =============================================================================
PG_AUTOVACUUM="on"
PG_AUTOVACUUM_MAX_WORKERS=4
PG_AUTOVACUUM_NAPTIME="1min"
PG_AUTOVACUUM_VACUUM_SCALE_FACTOR="0.05"
PG_AUTOVACUUM_ANALYZE_SCALE_FACTOR="0.02"
PG_AUTOVACUUM_VACUUM_COST_LIMIT=10000

# =============================================================================
# POSTGRESQL - PARALLEL QUERY (limited for OLTP)
# =============================================================================
PG_MAX_WORKER_PROCESSES=8
PG_MAX_PARALLEL_WORKERS_PER_GATHER=4
PG_MAX_PARALLEL_WORKERS=8
PG_JIT="off"

# =============================================================================
# POSTGRESQL - LOGGING
# =============================================================================
PG_LOG_MIN_DURATION_STATEMENT=1000
PG_LOG_TEMP_FILES=0
PG_LOG_CHECKPOINTS="on"
PG_LOG_LOCK_WAITS="on"

# =============================================================================
# HAMMERDB TPC-C CONFIG
# -----------------------------------------------------------------------------
# 400 warehouses = ~40GB dataset
# =============================================================================
HAMMERDB_WAREHOUSES=400
HAMMERDB_VIRTUAL_USERS=100
HAMMERDB_RAMPUP_MIN=2
HAMMERDB_DURATION_MIN=10
HAMMERDB_ALL_WAREHOUSE=true
