# Disk Configuration for PostgreSQL Primary
# Source: scripts/config/base.env
# r8g.xlarge: 8x NVMe EBS gp3 -> 2x RAID0 arrays

# === RAID LAYOUT ===
# md0 (DATA): 4x NVMe -> /data (200GB), chunk=512K
# md1 (WAL):  4x NVMe -> /wal (120GB), chunk=512K

# === BLOCK DEVICE TUNING ===
DATA_READ_AHEAD_KB=4096
WAL_READ_AHEAD_KB=4096

# === FSTAB ENTRIES ===
# Deploy to: /etc/fstab (append)
/dev/md0 /data xfs noatime,nodiratime,x-systemd.automount,x-systemd.device-timeout=30 0 0
/dev/md1 /wal xfs noatime,nodiratime,x-systemd.automount,x-systemd.device-timeout=30 0 0

# === UDEV RULES ===
# Deploy to: /etc/udev/rules.d/99-postgres-disk.rules
SUBSYSTEM=="block", KERNEL=="md0", ATTR{queue/read_ahead_kb}="4096"
SUBSYSTEM=="block", KERNEL=="md1", ATTR{queue/read_ahead_kb}="4096"
SUBSYSTEM=="block", KERNEL=="nvme[0-9]*n1", ATTR{queue/read_ahead_kb}="128", ATTR{queue/nr_requests}="63"

# === THP ===
THP_ENABLED=never
