# =============================================================================
# HARDWARE CONTEXT: r8g.large
# =============================================================================
# Instance: r8g.large (Memory Optimized, Graviton4)
# vCPU: 2 | RAM: 16 GB | Network: 12.5 Gbps | EBS: 10 Gbps
# Disk Array: 8 x 50 GB gp3 (raid10) = 200 GB usable
# Target: 5,000 TPS @ ~$73/month
# =============================================================================

# =============================================================================
# INSTANCE SPECS
# =============================================================================
INSTANCE_TYPE="r8g.large"
VCPU=2
RAM_GB=16
NETWORK_GBPS=12.5
EBS_GBPS=10

# =============================================================================
# OS TUNING - MEMORY
# =============================================================================
VM_SWAPPINESS=1
VM_DIRTY_BACKGROUND_RATIO=1
VM_DIRTY_RATIO=4
VM_DIRTY_EXPIRE_CENTISECS=200
VM_DIRTY_WRITEBACK_CENTISECS=100
VM_OVERCOMMIT_MEMORY=2
VM_OVERCOMMIT_RATIO=80
VM_MIN_FREE_KBYTES=167772
VM_ZONE_RECLAIM_MODE=0

# =============================================================================
# OS TUNING - FILE DESCRIPTORS
# =============================================================================
FS_FILE_MAX=2097152
FS_AIO_MAX_NR=1048576
ULIMIT_NOFILE=65535
ULIMIT_NPROC=65535

# =============================================================================
# OS TUNING - NETWORK/TCP
# =============================================================================
NET_CORE_SOMAXCONN=4096
NET_CORE_NETDEV_MAX_BACKLOG=2048
NET_CORE_RMEM_DEFAULT=262144
NET_CORE_RMEM_MAX=16777216
NET_CORE_WMEM_DEFAULT=262144
NET_CORE_WMEM_MAX=16777216
NET_IPV4_TCP_RMEM="4096 87380 16777216"
NET_IPV4_TCP_WMEM="4096 65536 16777216"
NET_IPV4_TCP_MAX_SYN_BACKLOG=4096
NET_IPV4_TCP_TW_REUSE=1
NET_IPV4_TCP_FIN_TIMEOUT=15

# =============================================================================
# OS TUNING - SCHEDULER
# =============================================================================
KERNEL_SCHED_AUTOGROUP_ENABLED=0
KERNEL_NUMA_BALANCING=0
KERNEL_SEM="250 32000 100 128"

# =============================================================================
# RAID CONFIG - DATA VOLUME
# =============================================================================
DATA_MOUNT="/data"
DATA_DISK_SIZE_GB=50
DATA_DISK_COUNT=8
DATA_RAID_LEVEL=10
DATA_RAID_DEVICE="/dev/md0"
DATA_RAID_CHUNK="64K"
DATA_STRIPE_WIDTH=4

# =============================================================================
# RAID CONFIG - WAL VOLUME
# =============================================================================
WAL_MOUNT="/wal"
WAL_DISK_SIZE_GB=30
WAL_DISK_COUNT=8
WAL_RAID_LEVEL=10
WAL_RAID_DEVICE="/dev/md1"
WAL_RAID_CHUNK="256K"
WAL_STRIPE_WIDTH=4

# =============================================================================
# XFS OPTIONS
# =============================================================================
FS_TYPE="xfs"
XFS_DATA_SUNIT="64k"
XFS_WAL_SUNIT="256k"
XFS_LOG_STRIPE_UNIT="1b"
XFS_DATA_AGCOUNT=16
XFS_WAL_AGCOUNT=8
XFS_MOUNT_OPTS_DATA="defaults,noatime,nodiratime,logbufs=8,logbsize=256k,allocsize=64m,inode64"
XFS_MOUNT_OPTS_WAL="defaults,noatime,nodiratime,logbufs=8,logbsize=256k,inode64"

# =============================================================================
# BLOCK DEVICE TUNING - DATA
# =============================================================================
DATA_SCHEDULER="none"
DATA_ROTATIONAL=0
DATA_READ_AHEAD_KB=64
DATA_NR_REQUESTS=256
DATA_MAX_SECTORS_KB=256
DATA_RQ_AFFINITY=2
DATA_ADD_RANDOM=0
DATA_NOMERGES=0

# =============================================================================
# BLOCK DEVICE TUNING - WAL
# =============================================================================
WAL_SCHEDULER="none"
WAL_ROTATIONAL=0
WAL_READ_AHEAD_KB=4096
WAL_NR_REQUESTS=128
WAL_MAX_SECTORS_KB=256
WAL_RQ_AFFINITY=2
WAL_ADD_RANDOM=0
WAL_NOMERGES=0

# =============================================================================
# MDADM TUNING
# =============================================================================
MD_STRIPE_CACHE_SIZE=8192

# =============================================================================
# FIO BENCHMARK CONFIG (disk testing)
# =============================================================================
FIO_RUNTIME=60
FIO_SIZE="1G"
FIO_NUMJOBS=2
