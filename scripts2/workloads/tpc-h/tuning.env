# =============================================================================
# WORKLOAD CONTEXT: TPC-H (HammerDB OLAP)
# =============================================================================
# Optimized for: Analytical queries with complex joins and aggregations
# Benchmark tool: HammerDB
# Dataset: SF40 (~40GB)
# Target: High QphH score
# =============================================================================
# CRITICAL DIFFERENCES FROM OLTP:
# - Higher work_mem for sort/hash operations
# - Full parallel query utilization
# - JIT compilation enabled
# - Lower shared_buffers (more RAM for work_mem)
# =============================================================================

# =============================================================================
# HUGEPAGES (calculated from shared_buffers)
# -----------------------------------------------------------------------------
# 16GB / 2MB = 8192, +7% = ~8800
# =============================================================================
VM_NR_HUGEPAGES=8800

# =============================================================================
# POSTGRESQL - PATHS
# =============================================================================
PG_VERSION=16
PG_DATA_DIR="/data/postgresql"
PG_WAL_DIR="/wal/pg_wal"
PG_LISTEN_ADDRESSES="*"
PG_PORT=5432

# =============================================================================
# POSTGRESQL - CONNECTIONS & MEMORY (OLAP OPTIMIZED)
# -----------------------------------------------------------------------------
# shared_buffers = 16GB (25% RAM) - lower than OLTP
# work_mem = 512MB - 10x higher for complex queries!
# effective_cache_size = 48GB - higher OS cache utilization
# =============================================================================
PG_MAX_CONNECTIONS=100
PG_SHARED_BUFFERS="16GB"
PG_HUGE_PAGES="on"
PG_WORK_MEM="512MB"
PG_MAINTENANCE_WORK_MEM="2GB"
PG_EFFECTIVE_CACHE_SIZE="48GB"
PG_HASH_MEM_MULTIPLIER="2.0"

# =============================================================================
# POSTGRESQL - DISK I/O
# =============================================================================
PG_RANDOM_PAGE_COST="1.1"
PG_SEQ_PAGE_COST="1.0"
PG_EFFECTIVE_IO_CONCURRENCY=200

# =============================================================================
# POSTGRESQL - WAL (less critical for read-heavy OLAP)
# =============================================================================
PG_WAL_COMPRESSION="lz4"
PG_WAL_BUFFERS="64MB"
PG_WAL_WRITER_DELAY="200ms"
PG_WAL_WRITER_FLUSH_AFTER="1MB"

# =============================================================================
# POSTGRESQL - CHECKPOINT
# =============================================================================
PG_MAX_WAL_SIZE="16GB"
PG_MIN_WAL_SIZE="1GB"
PG_CHECKPOINT_TIMEOUT="30min"
PG_CHECKPOINT_COMPLETION_TARGET="0.9"

# =============================================================================
# POSTGRESQL - SYNC (can be relaxed for analytics)
# =============================================================================
PG_SYNCHRONOUS_COMMIT="off"
PG_COMMIT_DELAY=0
PG_COMMIT_SIBLINGS=5

# =============================================================================
# POSTGRESQL - BACKGROUND WRITER
# =============================================================================
PG_BGWRITER_DELAY="200ms"
PG_BGWRITER_LRU_MAXPAGES=100
PG_BGWRITER_LRU_MULTIPLIER="2.0"

# =============================================================================
# POSTGRESQL - AUTOVACUUM
# =============================================================================
PG_AUTOVACUUM="on"
PG_AUTOVACUUM_MAX_WORKERS=2
PG_AUTOVACUUM_NAPTIME="5min"
PG_AUTOVACUUM_VACUUM_SCALE_FACTOR="0.1"
PG_AUTOVACUUM_ANALYZE_SCALE_FACTOR="0.05"
PG_AUTOVACUUM_VACUUM_COST_LIMIT=5000

# =============================================================================
# POSTGRESQL - PARALLEL QUERY (MAXIMIZED FOR OLAP)
# =============================================================================
PG_MAX_WORKER_PROCESSES=8
PG_MAX_PARALLEL_WORKERS_PER_GATHER=8
PG_MAX_PARALLEL_WORKERS=8
PG_MAX_PARALLEL_MAINTENANCE_WORKERS=4
PG_PARALLEL_LEADER_PARTICIPATION="on"
PG_JIT="on"
PG_JIT_ABOVE_COST=100000
PG_JIT_INLINE_ABOVE_COST=500000
PG_JIT_OPTIMIZE_ABOVE_COST=500000

# =============================================================================
# POSTGRESQL - PLANNER (OLAP OPTIMIZED)
# =============================================================================
PG_ENABLE_PARTITIONWISE_JOIN="on"
PG_ENABLE_PARTITIONWISE_AGGREGATE="on"
PG_ENABLE_PARALLEL_HASH="on"
PG_ENABLE_PARALLEL_APPEND="on"

# =============================================================================
# POSTGRESQL - LOGGING
# =============================================================================
PG_LOG_MIN_DURATION_STATEMENT=5000
PG_LOG_TEMP_FILES=0
PG_LOG_CHECKPOINTS="on"
PG_LOG_LOCK_WAITS="on"

# =============================================================================
# HAMMERDB TPC-H CONFIG
# -----------------------------------------------------------------------------
# SF40 = 40GB dataset
# =============================================================================
HAMMERDB_SCALE_FACTOR=40
HAMMERDB_VIRTUAL_USERS=8
HAMMERDB_REFRESH_ON=false
