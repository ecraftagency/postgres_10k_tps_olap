# =============================================================================
# WORKLOAD CONTEXT: OLTP Read-Only (sysbench)
# =============================================================================
# Optimized for: Read-intensive OLTP transactions
# Benchmark tool: sysbench oltp_read_only
#
# Memory settings (shared_buffers, work_mem, etc.) are AUTO-CALCULATED
# by config_loader.py based on hardware RAM/vCPU.
# =============================================================================

# =============================================================================
# POSTGRESQL - PATHS
# =============================================================================
PG_VERSION=16
PG_DATA_DIR="/data/postgresql"
PG_WAL_DIR="/wal/pg_wal"
PG_LISTEN_ADDRESSES="*"
PG_PORT=5432

# =============================================================================
# POSTGRESQL - CONNECTIONS
# =============================================================================
PG_MAX_CONNECTIONS=300
PG_HUGE_PAGES="try"

# =============================================================================
# POSTGRESQL - MEMORY RATIOS (used by config_loader for calculation)
# -----------------------------------------------------------------------------
# shared_buffers = RAM * 0.25 (standard)
# For read-heavy, effective_cache_size is more important
# =============================================================================
PG_SHARED_BUFFERS_RATIO=0.25

# =============================================================================
# POSTGRESQL - DISK I/O (read-optimized)
# =============================================================================
PG_RANDOM_PAGE_COST="1.1"
PG_SEQ_PAGE_COST="1.0"
PG_EFFECTIVE_IO_CONCURRENCY=200

# =============================================================================
# POSTGRESQL - WAL (minimal for read-only)
# =============================================================================
PG_WAL_COMPRESSION="lz4"
PG_WAL_WRITER_DELAY="200ms"
PG_WAL_WRITER_FLUSH_AFTER="1MB"

# =============================================================================
# POSTGRESQL - CHECKPOINT (relaxed for read-heavy)
# =============================================================================
PG_MIN_WAL_SIZE="1GB"
PG_CHECKPOINT_TIMEOUT="30min"
PG_CHECKPOINT_COMPLETION_TARGET="0.9"

# =============================================================================
# POSTGRESQL - SYNC (standard)
# =============================================================================
PG_SYNCHRONOUS_COMMIT="on"
PG_COMMIT_DELAY=0
PG_COMMIT_SIBLINGS=5

# =============================================================================
# POSTGRESQL - BACKGROUND WRITER (less aggressive for reads)
# =============================================================================
PG_BGWRITER_DELAY="200ms"
PG_BGWRITER_LRU_MULTIPLIER="2.0"

# =============================================================================
# POSTGRESQL - AUTOVACUUM (standard)
# =============================================================================
PG_AUTOVACUUM="on"
PG_AUTOVACUUM_NAPTIME="1min"
PG_AUTOVACUUM_VACUUM_SCALE_FACTOR="0.05"
PG_AUTOVACUUM_ANALYZE_SCALE_FACTOR="0.02"
PG_AUTOVACUUM_VACUUM_COST_LIMIT=10000

# =============================================================================
# POSTGRESQL - PARALLEL QUERY (enabled for reads)
# -----------------------------------------------------------------------------
# max_parallel_workers auto-calculated based on vCPU
# =============================================================================
PG_JIT="off"

# =============================================================================
# POSTGRESQL - LOGGING
# =============================================================================
PG_LOG_MIN_DURATION_STATEMENT=1000
PG_LOG_TEMP_FILES=0
PG_LOG_CHECKPOINTS="on"
PG_LOG_LOCK_WAITS="on"

# =============================================================================
# SYSBENCH CONFIG
# =============================================================================
SYSBENCH_HOST="127.0.0.1"
SYSBENCH_USER="postgres"
SYSBENCH_PASSWORD="postgres"
SYSBENCH_DATABASE="sysbench"
SYSBENCH_TABLES=10
SYSBENCH_TABLE_SIZE=1000000

# Benchmark defaults
SYSBENCH_DURATION=60
SYSBENCH_THREADS_LIGHT=8
SYSBENCH_THREADS_MEDIUM=32
SYSBENCH_THREADS_HEAVY=64
